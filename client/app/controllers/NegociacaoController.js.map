{"version":3,"sources":["../../app-src/controllers/NegociacaoController.js"],"names":["Negociacoes","NegociacaoService","Negociacao","NegociacoesView","MensagemView","Mensagem","DateConverter","getNegociacaoDao","Bind","getExceptionMessage","debounce","controller","NegociacaoController","constructor","_inputData","_inputQuantidade","_inputValor","$","document","querySelector","bind","Object","assign","_negociacoes","_mensagem","_mensagemView","_service","_init","dao","negociacoes","listaTodos","forEach","adiciona","negociacao","err","texto","event","preventDefault","_criaNegociacao","_limpaFormulario","value","focus","paraData","parseInt","parseFloat","apaga","apagaTodos","esvazia","importaNegociacoes","obtemNegociacoesDoPeriodo","console","log","filter","paraArray","some","novaNegociacao","equals","negociacaoExistente"],"mappings":"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","file":"NegociacaoController.js","sourcesContent":["import  {   Negociacoes,    NegociacaoService,  Negociacao} from    '../domain/index.js';\r\nimport  {   NegociacoesView,    MensagemView,   Mensagem, DateConverter   }       from    '../ui/index.js';\r\nimport  {   getNegociacaoDao,   Bind, getExceptionMessage, debounce, controller }  from    '../util/index.js';\r\n@controller('#data', '#quantidade', '#valor')\r\nexport class NegociacaoController {\r\n\tconstructor(_inputData, _inputQuantidade, _inputValor) {\r\n\t//\ta\tideia\té\tque\t$\tseja\to\tquerySelector\r\n\t\tconst\t$\t=\tdocument.querySelector.bind(document);\r\n        Object.assign(this, {_inputData, _inputQuantidade, _inputValor});\r\n        this._negociacoes = new Bind(\r\n        \tnew Negociacoes(),\r\n        \tnew NegociacoesView('#negociacoes'),\r\n        \t'adiciona', 'esvazia',\r\n        );\r\n\r\n        this._mensagem = new Bind(\r\n        \tnew Mensagem(),\r\n        \tnew MensagemView('#mensagemView'),\r\n        \t'texto'\r\n        \t);\r\n        this._mensagemView = new MensagemView('#mensagemView');\r\n   \t\tthis._service = new NegociacaoService();\r\n \t\t\r\n \t\tthis._init();\r\n    }\r\n\r\n    async _init() {\r\n   \t\ttry {\r\n            const dao = await getNegociacaoDao();\r\n            const negociacoes = await dao.listaTodos();\r\n            negociacoes.forEach(negociacao => this._negociacoes\r\n                .adiciona(negociacao));\r\n            } catch(err) {\r\n                this._mensagem.texto =  getExceptionMessage(err);\r\n            }\r\n        }\r\n\r\n    @debounce(1500)\r\n\tasync adiciona(event) {\r\n\t\ttry { \r\n\t\t\tevent.preventDefault();\r\n            const negociacao = this._criaNegociacao();\r\n            const dao = await getNegociacaoDao();\r\n            await dao.adiciona(negociacao);\r\n            this._negociacoes.adiciona(negociacao);\r\n            this._mensagem.texto = 'Negociação adicionada com sucesso';\r\n            this._limpaFormulario();\r\n\t\t} catch(err) {\r\n            this._mensagem.texto = getExceptionMessage(err);\r\n\t\t}\r\n\t}\r\n\r\n\t_limpaFormulario()\t{\r\n\t\tthis._inputData.value\t=\t'';\r\n\t\tthis._inputQuantidade.value\t=\t1;\r\n\t\tthis._inputValor.value\t=\t0.0\r\n\t\tthis._inputData.focus();\r\n\t}\r\n\r\n\t_criaNegociacao()\t{\r\n\t//\tretorna\tuma\tinstância\tde\tnegociação\r\n\treturn new\tNegociacao(\r\n\t\tDateConverter.paraData(this._inputData.value),\r\n\t\tparseInt(this._inputQuantidade.value),\r\n\t\tparseFloat(this._inputValor.value)\r\n\t\t);\t\r\n\t}\r\n\r\n\tasync apaga() {\r\n\t\t try {\r\n            const dao = await getNegociacaoDao();\r\n            await dao.apagaTodos();\r\n            this._negociacoes.esvazia();\r\n            this._mensagem.texto = 'Negociações apagadas com sucesso';\r\n         } catch (err){\r\n           this._mensagem.texto = getExceptionMessage(err);\r\n         }\r\n\t}\r\n\r\n    @debounce(1500)\r\n\tasync importaNegociacoes() {\r\n        try {\r\n            const negociacoes = await this._service\r\n                .obtemNegociacoesDoPeriodo();\r\n            console.log(negociacoes);\r\n            negociacoes.filter(novaNegociacao => \r\n                !this._negociacoes.paraArray().some(negociacaoExistente => \r\n                    novaNegociacao.equals(negociacaoExistente)))\r\n                .forEach(negociacao => this._negociacoes.adiciona(negociacao));\r\n                 this._mensagem.texto = 'Negociações do período importadas com sucesso';\r\n        } catch (err) {\r\n            this._mensagem.texto = getExceptionMessage(err);\r\n        }  \r\n\r\n\t\t/*this._service\r\n\t\t\t.obtemNegociacoesDoPeriodo()\r\n\t\t\t.then(negociacoes => {\r\n\r\n\t\t\t\tnegociacoes.filter(novaNegociacao => \r\n\r\n\t\t\t\t\t!this._negociacoes.paraArray().some(negociacaoExistente => \r\n\r\n\t\t\t\t\t\tnovaNegociacao.equals(negociacaoExistente)))\r\n\r\n\t\t\t\t.forEach(negociacao => this._negociacoes\r\n\t\t\t\t\t.adiciona(negociacao));\r\n\t\t\t\tthis._mensagem.texto ='Negociações do período importadas com sucesso';\r\n\t\t\t})\r\n\t\t\t.catch(err => this._mensagem.texto = err);\r\n            */\r\n\t}\r\n}"]}